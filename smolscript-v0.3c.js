(()=>{var e={7142:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(9505);Array.prototype.appendChunk||(Array.prototype.appendChunk=function(e){if(Array.isArray(e))e.forEach((e=>{this.push(e)}));else{if(!(e instanceof s.ByteCodeInstruction))throw new Error(`Can't append ${e} to chunk`);this.push(e)}return this}),Array.prototype.appendInstruction||(Array.prototype.appendInstruction=function(e,t,n){const o=new s.ByteCodeInstruction(e,t,n);return o.token_map_end_index=void 0,this.push(o),this}),Array.prototype.peek||(Array.prototype.peek=function(){return this[this.length-1]}),Array.prototype.mapTokens||(Array.prototype.mapTokens=function(e,t){for(var n of this)null==n.token_map_start_index&&(n.token_map_start_index=e),null==n.token_map_end_index&&(n.token_map_end_index=t);return this})},7593:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssignExpression=void 0,t.AssignExpression=class{getExpressionType(){return"Assign"}constructor(e,t){this.name=e,this.value=t}accept(e){return e.visitAssignExpression(this)}}},554:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryExpression=void 0,t.BinaryExpression=class{getExpressionType(){return"Binary"}constructor(e,t,n){this.left=e,this.op=t,this.right=n}accept(e){return e.visitBinaryExpression(this)}}},3651:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallExpression=void 0,t.CallExpression=class{getExpressionType(){return"Call"}constructor(e,t,n){this.callee=e,this.args=t,this.useObjectRef=n}accept(e){return e.visitCallExpression(this)}}},3125:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionExpression=void 0,t.FunctionExpression=class{getExpressionType(){return"Function"}constructor(e,t){this.parameters=e,this.functionBody=t}accept(e){return e.visitFunctionExpression(this)}}},7623:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetExpression=void 0,t.GetExpression=class{getExpressionType(){return"Get"}constructor(e,t){this.obj=e,this.name=t}accept(e){return e.visitGetExpression(this)}}},3579:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupingExpression=void 0,t.GroupingExpression=class{getExpressionType(){return"Grouping"}constructor(e){this.expr=e}accept(e){return e.visitGroupingExpression(this)}}},3246:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexerGetExpression=void 0,t.IndexerGetExpression=class{getExpressionType(){return"IndexerGet"}constructor(e,t){this.obj=e,this.indexerExpr=t}accept(e){return e.visitIndexerGetExpression(this)}}},5584:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexerSetExpression=void 0,t.IndexerSetExpression=class{getExpressionType(){return"IndexerSet"}constructor(e,t,n){this.obj=e,this.indexerExpr=t,this.value=n}accept(e){return e.visitIndexerSetExpression(this)}}},9355:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiteralExpression=void 0,t.LiteralExpression=class{getExpressionType(){return"Literal"}constructor(e){this.value=e}accept(e){return e.visitLiteralExpression(this)}}},42:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogicalExpression=void 0,t.LogicalExpression=class{getExpressionType(){return"Logical"}constructor(e,t,n){this.left=e,this.op=t,this.right=n}accept(e){return e.visitLogicalExpression(this)}}},1661:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewInstanceExpression=void 0,t.NewInstanceExpression=class{getExpressionType(){return"NewInstance"}constructor(e,t){this.className=e,this.ctorArgs=t}accept(e){return e.visitNewInstanceExpression(this)}}},5522:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectInitializerExpression=void 0,t.ObjectInitializerExpression=class{getExpressionType(){return"ObjectInitializer"}constructor(e,t){this.name=e,this.value=t}accept(e){return e.visitObjectInitializerExpression(this)}}},2880:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetExpression=void 0,t.SetExpression=class{getExpressionType(){return"Set"}constructor(e,t,n){this.obj=e,this.name=t,this.value=n}accept(e){return e.visitSetExpression(this)}}},2247:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TernaryExpression=void 0,t.TernaryExpression=class{getExpressionType(){return"Ternary"}constructor(e,t,n){this.evaluationExpression=e,this.expresisonIfTrue=t,this.expresisonIfFalse=n}accept(e){return e.visitTernaryExpression(this)}}},335:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnaryExpression=void 0,t.UnaryExpression=class{getExpressionType(){return"Unary"}constructor(e,t){this.op=e,this.right=t}accept(e){return e.visitUnaryExpression(this)}}},9402:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VariableExpression=void 0,t.VariableExpression=class{getExpressionType(){return"Variable"}constructor(e,t){this.name=e,this.prepostfixOp=t}accept(e){return e.visitVariableExpression(this)}}},1936:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockStatement=void 0,t.BlockStatement=class{getStatementType(){return"Block"}constructor(e,t=!1){this.statements=e,this.isVirtual=t}accept(e){return e.visitBlockStatement(this)}}},7856:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BreakStatement=void 0,t.BreakStatement=class{getStatementType(){return"Break"}accept(e){return e.visitBreakStatement(this)}}},8262:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClassStatement=void 0,t.ClassStatement=class{getStatementType(){return"Class"}constructor(e,t,n){this.className=e,this.superclassName=t,this.functions=n}accept(e){return e.visitClassStatement(this)}}},8237:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContinueStatement=void 0,t.ContinueStatement=class{getStatementType(){return"Continue"}accept(e){return e.visitContinueStatement(this)}}},1226:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebuggerStatement=void 0,t.DebuggerStatement=class{getStatementType(){return"Debugger"}accept(e){return e.visitDebuggerStatement(this)}}},6017:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionStatement=void 0,t.ExpressionStatement=class{getStatementType(){return"Expression"}constructor(e){this.expression=e}accept(e){return e.visitExpressionStatement(this)}}},4736:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionStatement=void 0,t.FunctionStatement=class{getStatementType(){return"Function"}constructor(e,t,n){this.name=e,this.parameters=t,this.functionBody=n}accept(e){return e.visitFunctionStatement(this)}}},3549:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IfStatement=void 0,t.IfStatement=class{getStatementType(){return"If"}constructor(e,t,n){this.expression=e,this.thenStatement=t,this.elseStatement=n}accept(e){return e.visitIfStatement(this)}}},2802:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrintStatement=void 0,t.PrintStatement=class{getStatementType(){return"Print"}constructor(e){this.expression=e}accept(e){return e.visitPrintStatement(this)}}},2698:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReturnStatement=void 0,t.ReturnStatement=class{getStatementType(){return"Return"}constructor(e){this.expression=e}accept(e){return e.visitReturnStatement(this)}}},4768:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThrowStatement=void 0,t.ThrowStatement=class{getStatementType(){return"Throw"}constructor(e){this.expression=e}accept(e){return e.visitThrowStatement(this)}}},2351:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TryStatement=void 0,t.TryStatement=class{getStatementType(){return"Try"}constructor(e,t,n,s){this.tryBody=e,this.exceptionVariableName=t,this.catchBody=n,this.finallyBody=s}accept(e){return e.visitTryStatement(this)}}},3641:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VarStatement=void 0,t.VarStatement=class{getStatementType(){return"Var"}constructor(e,t){this.name=e,this.initializerExpression=t}accept(e){return e.visitVarStatement(this)}}},6295:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WhileStatement=void 0,t.WhileStatement=class{getStatementType(){return"While"}constructor(e,t){this.whileCondition=e,this.executeStatement=t}accept(e){return e.visitWhileStatement(this)}}},9505:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ByteCodeInstruction=void 0,t.ByteCodeInstruction=class{constructor(e,t,n){this.opcode=e,this.operand1=t,this.operand2=n,this.isStatementStartpoint=!1}toString(){return this.opcode.toString()}}},5672:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Compiler=void 0;const s=n(9505),o=n(208),i=n(8681),r=n(3427),a=n(7033),p=n(2590),c=n(6341),h=n(8017),u=n(4240),d=n(2728);n(7142);class l{constructor(e,t){this.startOfLoop=e,this.endOfLoop=t}}t.Compiler=class{constructor(){this._function_table=[],this._function_bodies=new Array,this._nextLabel=1,this._constants=[],this._loopStack=new Array}reserveLabelId(){return this._nextLabel++}ensureConst(e){let t=-1;return this._constants.forEach(((n,s)=>{n.getValue()===e.getValue()&&(t=s)})),-1==t&&(t=this._constants.push(e)-1),t}Compile(e){const t=r.Scanner.tokenize(e),n=a.Parser.parse(t),s=this.createChunk();s.appendInstruction(o.OpCode.START),s[0].isStatementStartpoint=!0;for(let e=0;e<n.length;e++)s.length,s.appendChunk(n[e].accept(this));s.appendInstruction(o.OpCode.EOF),s[s.length-1].isStatementStartpoint=!0;const i=new p.SmolProgram;return i.constants=this._constants,i.code_sections.push(s),this._function_bodies.forEach((e=>i.code_sections.push(e))),i.function_table=this._function_table,i.tokens=t,i.source=e,i}createChunk(){return new Array}visitBlockStatement(e){const t=this.createChunk();var n=new s.ByteCodeInstruction(o.OpCode.ENTER_SCOPE);n.token_map_start_index=e.blockStartTokenIndex,n.token_map_end_index=e.blockStartTokenIndex,0==e.isVirtual&&(n.isStatementStartpoint=!0),t.appendChunk(n),e.statements.forEach((e=>{const n=e.accept(this);t.appendChunk(n)}));var i=new s.ByteCodeInstruction(o.OpCode.LEAVE_SCOPE);return i.token_map_start_index=e.blockEndTokenIndex,i.token_map_end_index=e.blockEndTokenIndex,0==e.isVirtual&&(i.isStatementStartpoint=!0),t.appendChunk(i),t}visitBreakStatement(e){const t=this.createChunk();return t.appendInstruction(o.OpCode.LOOP_EXIT,this._loopStack.peek().endOfLoop),t[0].isStatementStartpoint=!0,t.mapTokens(e.tokenIndex,e.tokenIndex),t}visitClassStatement(e){return e.functions.forEach((t=>{const n=this._function_bodies.length+1,s=`@${e.className.lexeme}.${t.name.lexeme}`;this._function_table.push(new i.SmolFunction(s,n,t.parameters.length,t.parameters.map((e=>e.lexeme))));const r=this.createChunk();r.appendChunk(t.functionBody.accept(this)),0!=r.length&&r.peek().opcode==o.OpCode.RETURN||(r.appendInstruction(o.OpCode.CONST,this.ensureConst(new u.SmolUndefined)),r.appendInstruction(o.OpCode.RETURN)),this._function_bodies.push(r)})),new s.ByteCodeInstruction(o.OpCode.NOP)}visitContinueStatement(e){const t=this.createChunk();return t.appendInstruction(o.OpCode.LOOP_EXIT,this._loopStack.peek().startOfLoop),t[0].isStatementStartpoint=!0,t.mapTokens(e.tokenIndex,e.tokenIndex),t}visitDebuggerStatement(e){const t=this.createChunk();return t.appendInstruction(o.OpCode.DEBUGGER),t[0].isStatementStartpoint=!0,t.mapTokens(e.tokenIndex,e.tokenIndex),t}visitExpressionStatement(e){const t=this.createChunk();return t.appendChunk(e.expression.accept(this)),t.appendInstruction(o.OpCode.POP_AND_DISCARD),t[0].isStatementStartpoint=!0,t.mapTokens(e.firstTokenIndex,e.lastTokenIndex),t}visitFunctionStatement(e){const t=this._function_bodies.length+1,n=e.name.lexeme;this._function_table.push(new i.SmolFunction(n,t,e.parameters.length,e.parameters.map((e=>e.lexeme))));const r=this.createChunk();return r.appendChunk(e.functionBody.accept(this)),0!=r.length&&r.peek().opcode==o.OpCode.RETURN||(r.appendInstruction(o.OpCode.CONST,this.ensureConst(new u.SmolUndefined)),r.appendInstruction(o.OpCode.RETURN)),this._function_bodies.push(r),new s.ByteCodeInstruction(o.OpCode.NOP)}visitIfStatement(e){const t=this.createChunk(),n=this.reserveLabelId();t.appendChunk(e.expression.accept(this)),t[0].isStatementStartpoint=!0,t.appendInstruction(o.OpCode.JMPFALSE,n);const s=e.thenStatement.accept(this);if(s instanceof Array?(s.mapTokens(e.thenFirstTokenIndex,e.thenLastTokenIndex),"Block"!=e.thenStatement.getStatementType()&&(s[0].isStatementStartpoint=!0)):(s.token_map_start_index=e.thenFirstTokenIndex,s.token_map_end_index=e.thenLastTokenIndex),t.appendChunk(s),null==e.elseStatement)t.appendInstruction(o.OpCode.LABEL,n);else{const s=this.reserveLabelId();t.appendInstruction(o.OpCode.JMP,s),t.appendInstruction(o.OpCode.LABEL,n),t.appendChunk(e.elseStatement.accept(this)),t.appendInstruction(o.OpCode.LABEL,s)}return t.mapTokens(e.exprFirstTokenIndex,e.exprLastTokenIndex),t}visitPrintStatement(e){const t=this.createChunk();return t.appendChunk(e.expression.accept(this)),t.appendInstruction(o.OpCode.PRINT),t}visitReturnStatement(e){const t=this.createChunk();return null!=e.expression?t.appendChunk(e.expression.accept(this)):t.appendInstruction(o.OpCode.CONST,this.ensureConst(new u.SmolUndefined)),t.appendInstruction(o.OpCode.RETURN),t}visitTryStatement(e){const t=this.createChunk(),n=this.reserveLabelId(),s=this.reserveLabelId(),i=this.reserveLabelId();return t.appendInstruction(o.OpCode.TRY,n,!1),t.appendChunk(e.tryBody.accept(this)),t.appendInstruction(o.OpCode.POP_AND_DISCARD),t.appendInstruction(o.OpCode.JMP,s),t.appendInstruction(o.OpCode.LABEL,n),t.appendInstruction(o.OpCode.TRY,i,!0),null!=e.catchBody?(null!=e.exceptionVariableName?(t.appendInstruction(o.OpCode.ENTER_SCOPE),t.appendInstruction(o.OpCode.DECLARE,e.exceptionVariableName.lexeme),t.appendInstruction(o.OpCode.STORE,e.exceptionVariableName.lexeme)):t.appendInstruction(o.OpCode.POP_AND_DISCARD),t.appendChunk(e.catchBody.accept(this)),null!=e.exceptionVariableName&&t.appendInstruction(o.OpCode.LEAVE_SCOPE)):t.appendInstruction(o.OpCode.THROW),t.appendInstruction(o.OpCode.POP_AND_DISCARD),t.appendInstruction(o.OpCode.JMP,s),t.appendInstruction(o.OpCode.LABEL,i),null!=e.finallyBody&&t.appendChunk(e.finallyBody.accept(this)),t.appendInstruction(o.OpCode.THROW),t.appendInstruction(o.OpCode.LABEL,s),null!=e.finallyBody&&t.appendChunk(e.finallyBody.accept(this)),t}visitThrowStatement(e){const t=this.createChunk();return t.appendChunk(e.expression.accept(this)),t.appendInstruction(o.OpCode.THROW),t}visitVarStatement(e){const t=this.createChunk();return t.appendInstruction(o.OpCode.DECLARE,e.name.lexeme),null!=e.initializerExpression&&(t.appendChunk(e.initializerExpression.accept(this)),t.appendInstruction(o.OpCode.STORE,e.name.lexeme)),t.mapTokens(e.firstTokenIndex,e.lastTokenIndex),t[0].isStatementStartpoint=!0,t}visitWhileStatement(e){const t=this.createChunk(),n=this.reserveLabelId(),s=this.reserveLabelId();this._loopStack.push(new l(n,s)),t.appendInstruction(o.OpCode.LOOP_START),t.appendInstruction(o.OpCode.LABEL,n);const i=e.whileCondition.accept(this);null==i[0]?i.isStatementStartpoint=!0:i[0].isStatementStartpoint=!0,t.appendChunk(i),t.appendInstruction(o.OpCode.JMPFALSE,s);const r=e.executeStatement.accept(this);return r.mapTokens(e.stmtFirstTokenIndex,e.stmtLastTokenIndex),t.appendChunk(r),t.appendInstruction(o.OpCode.JMP,n),t.appendInstruction(o.OpCode.LABEL,s),t.appendInstruction(o.OpCode.LOOP_END),t.mapTokens(e.exprFirstTokenIndex,e.exprLastTokenIndex),this._loopStack.pop(),t}visitAssignExpression(e){const t=this.createChunk();return t.appendChunk(e.value.accept(this)),t.appendInstruction(o.OpCode.STORE,e.name.lexeme),t.appendInstruction(o.OpCode.FETCH,e.name.lexeme),t[0].isStatementStartpoint=!0,t}visitBinaryExpression(e){const t=this.createChunk();switch(t.appendChunk(e.left.accept(this)),t.appendChunk(e.right.accept(this)),e.op.type){case h.TokenType.MINUS:t.appendInstruction(o.OpCode.SUB);break;case h.TokenType.DIVIDE:t.appendInstruction(o.OpCode.DIV);break;case h.TokenType.MULTIPLY:t.appendInstruction(o.OpCode.MUL);break;case h.TokenType.PLUS:t.appendInstruction(o.OpCode.ADD);break;case h.TokenType.POW:t.appendInstruction(o.OpCode.POW);break;case h.TokenType.REMAINDER:t.appendInstruction(o.OpCode.REM);break;case h.TokenType.EQUAL_EQUAL:t.appendInstruction(o.OpCode.EQL);break;case h.TokenType.NOT_EQUAL:t.appendInstruction(o.OpCode.NEQ);break;case h.TokenType.GREATER:t.appendInstruction(o.OpCode.GT);break;case h.TokenType.GREATER_EQUAL:t.appendInstruction(o.OpCode.GTE);break;case h.TokenType.LESS:t.appendInstruction(o.OpCode.LT);break;case h.TokenType.LESS_EQUAL:t.appendInstruction(o.OpCode.LTE);break;case h.TokenType.BITWISE_AND:t.appendInstruction(o.OpCode.BITWISE_AND);break;case h.TokenType.BITWISE_OR:t.appendInstruction(o.OpCode.BITWISE_OR);break;default:throw new Error("Binary operation not impleented")}return t}visitCallExpression(e){const t=this.createChunk();return e.args.reverse().forEach((e=>{t.appendChunk(e.accept(this))})),t.appendChunk(e.callee.accept(this)),t.appendInstruction(o.OpCode.CALL,e.args.length,e.useObjectRef),t}visitFunctionExpression(e){const t=this._function_bodies.length+1,n=`$_anon_${t}`;this._function_table.push(new i.SmolFunction(n,t,e.parameters.length,e.parameters.map((e=>e.lexeme))));const r=this.createChunk();return r.appendChunk(e.functionBody.accept(this)),0!=r.length&&r.peek().opcode==o.OpCode.RETURN||(r.appendInstruction(o.OpCode.CONST,this.ensureConst(new u.SmolUndefined)),r.appendInstruction(o.OpCode.RETURN)),this._function_bodies.push(r),new s.ByteCodeInstruction(o.OpCode.FETCH,n)}visitGetExpression(e){const t=this.createChunk();return t.appendChunk(e.obj.accept(this)),t.appendInstruction(o.OpCode.FETCH,e.name.lexeme,!0),t}visitGroupingExpression(e){return e.expr.accept(this)}visitIndexerGetExpression(e){const t=this.createChunk();return t.appendChunk(e.obj.accept(this)),t.appendChunk(e.indexerExpr.accept(this)),t.appendInstruction(o.OpCode.FETCH,"@IndexerGet",!0),t}visitIndexerSetExpression(e){const t=this.createChunk();return t.appendChunk(e.obj.accept(this)),t.appendChunk(e.value.accept(this)),t.appendChunk(e.indexerExpr.accept(this)),t.appendInstruction(o.OpCode.STORE,"@IndexerSet",!0),t.appendChunk(e.obj.accept(this)),t.appendChunk(e.indexerExpr.accept(this)),t.appendInstruction(o.OpCode.FETCH,"@IndexerSet",!0),t}visitLiteralExpression(e){const t=this.ensureConst(e.value);return new s.ByteCodeInstruction(o.OpCode.CONST,t)}visitLogicalExpression(e){const t=this.createChunk(),n=this.reserveLabelId(),s=this.reserveLabelId();switch(e.op.type){case h.TokenType.LOGICAL_AND:t.appendChunk(e.left.accept(this)),t.appendInstruction(o.OpCode.JMPFALSE,n),t.appendChunk(e.right.accept(this)),t.appendInstruction(o.OpCode.JMP,s),t.appendInstruction(o.OpCode.LABEL,n),t.appendInstruction(o.OpCode.CONST,this.ensureConst(new c.SmolBool(!1))),t.appendInstruction(o.OpCode.LABEL,s);break;case h.TokenType.LOGICAL_OR:t.appendChunk(e.left.accept(this)),t.appendInstruction(o.OpCode.JMPTRUE,n),t.appendChunk(e.right.accept(this)),t.appendInstruction(o.OpCode.JMP,s),t.appendInstruction(o.OpCode.LABEL,n),t.appendInstruction(o.OpCode.CONST,this.ensureConst(new c.SmolBool(!0))),t.appendInstruction(o.OpCode.LABEL,s)}return t}visitNewInstanceExpression(e){const t=this.createChunk(),n=e.className.lexeme;return t.appendInstruction(o.OpCode.CREATE_OBJECT,n),"Object"!=n?(e.ctorArgs.reverse().forEach((e=>{t.appendChunk(e.accept(this))})),t.appendInstruction(o.OpCode.DUPLICATE_VALUE,e.ctorArgs.length)):t.appendInstruction(o.OpCode.DUPLICATE_VALUE,0),t.appendInstruction(o.OpCode.FETCH,`@${e.className.lexeme}.constructor`,!0),"Object"==n&&e.ctorArgs.reverse().forEach((e=>{t.appendChunk(e.accept(this))})),t.appendInstruction(o.OpCode.CALL,e.ctorArgs.length,!0),t.appendInstruction(o.OpCode.POP_AND_DISCARD),t}visitObjectInitializerExpression(e){const t=this.createChunk();return t.appendInstruction(o.OpCode.DUPLICATE_VALUE,2),t.appendChunk(e.value.accept(this)),t.appendInstruction(o.OpCode.STORE,e.name.lexeme,!0),t}visitSetExpression(e){const t=this.createChunk();return t.appendChunk(e.obj.accept(this)),t.appendChunk(e.value.accept(this)),t.appendInstruction(o.OpCode.STORE,e.name.lexeme,!0),t.appendChunk(e.obj.accept(this)),t.appendInstruction(o.OpCode.FETCH,e.name.lexeme,!0),t}visitTernaryExpression(e){const t=this.createChunk(),n=this.reserveLabelId(),s=this.reserveLabelId();return t.appendChunk(e.evaluationExpression.accept(this)),t.appendInstruction(o.OpCode.JMPFALSE,n),t.appendChunk(e.expresisonIfTrue.accept(this)),t.appendInstruction(o.OpCode.JMP,s),t.appendInstruction(o.OpCode.LABEL,n),t.appendChunk(e.expresisonIfFalse.accept(this)),t.appendInstruction(o.OpCode.LABEL,s),t}visitUnaryExpression(e){const t=this.createChunk();switch(e.op.type){case h.TokenType.NOT:{t.appendChunk(e.right.accept(this));const n=this.reserveLabelId(),s=this.reserveLabelId();t.appendInstruction(o.OpCode.JMPTRUE,n),t.appendInstruction(o.OpCode.CONST,this.ensureConst(new c.SmolBool(!0))),t.appendInstruction(o.OpCode.JMP,s),t.appendInstruction(o.OpCode.LABEL,n),t.appendInstruction(o.OpCode.CONST,this.ensureConst(new c.SmolBool(!1))),t.appendInstruction(o.OpCode.LABEL,s);break}case h.TokenType.MINUS:t.appendInstruction(o.OpCode.CONST,this.ensureConst(new d.SmolNumber(0))),t.appendChunk(e.right.accept(this)),t.appendInstruction(o.OpCode.SUB)}return t}visitVariableExpression(e){const t=this.createChunk();return t.appendInstruction(o.OpCode.FETCH,e.name.lexeme),null!=e.prepostfixOp&&(e.prepostfixOp==h.TokenType.POSTFIX_INCREMENT&&(t.appendInstruction(o.OpCode.FETCH,e.name.lexeme),t.appendInstruction(o.OpCode.CONST,this.ensureConst(new d.SmolNumber(1))),t.appendInstruction(o.OpCode.ADD),t.appendInstruction(o.OpCode.STORE,e.name.lexeme)),e.prepostfixOp==h.TokenType.POSTFIX_DECREMENT&&(t.appendInstruction(o.OpCode.FETCH,e.name.lexeme),t.appendInstruction(o.OpCode.CONST,this.ensureConst(new d.SmolNumber(1))),t.appendInstruction(o.OpCode.SUB),t.appendInstruction(o.OpCode.STORE,e.name.lexeme)),e.prepostfixOp==h.TokenType.PREFIX_INCREMENT&&(t.appendInstruction(o.OpCode.CONST,this.ensureConst(new d.SmolNumber(1))),t.appendInstruction(o.OpCode.ADD),t.appendInstruction(o.OpCode.STORE,e.name.lexeme),t.appendInstruction(o.OpCode.FETCH,e.name.lexeme)),e.prepostfixOp==h.TokenType.PREFIX_DECREMENT&&(t.appendInstruction(o.OpCode.CONST,this.ensureConst(new d.SmolNumber(1))),t.appendInstruction(o.OpCode.SUB),t.appendInstruction(o.OpCode.STORE,e.name.lexeme),t.appendInstruction(o.OpCode.FETCH,e.name.lexeme))),t}}},4011:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Environment=void 0,t.Environment=class{constructor(e){this._variables={},this.enclosing=e}define(e,t){this._variables[e]=t}assign(e,t,n=!1){if(null!=this._variables[e])this._variables[e]=t;else if(n)this.define(e,t);else{if(null==this.enclosing)throw new Error("Variable undefined");this.enclosing.assign(e,t)}}get(e){if(null!=this._variables[e])return this._variables[e];if(null!=this.enclosing)return this.enclosing.get(e);throw new Error("Variable undefined")}tryGet(e){return null!=this._variables[e]?this._variables[e]:null!=this.enclosing?this.enclosing.tryGet(e):void 0}}},208:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.OpCode=void 0,function(e){e[e.NOP=0]="NOP",e[e.LABEL=1]="LABEL",e[e.CALL=2]="CALL",e[e.RETURN=3]="RETURN",e[e.ADD=4]="ADD",e[e.SUB=5]="SUB",e[e.DIV=6]="DIV",e[e.MUL=7]="MUL",e[e.POW=8]="POW",e[e.REM=9]="REM",e[e.EQL=10]="EQL",e[e.NEQ=11]="NEQ",e[e.LT=12]="LT",e[e.LTE=13]="LTE",e[e.GT=14]="GT",e[e.GTE=15]="GTE",e[e.BITWISE_AND=16]="BITWISE_AND",e[e.BITWISE_OR=17]="BITWISE_OR",e[e.JMPTRUE=18]="JMPTRUE",e[e.JMPFALSE=19]="JMPFALSE",e[e.JMP=20]="JMP",e[e.DECLARE=21]="DECLARE",e[e.CONST=22]="CONST",e[e.FETCH=23]="FETCH",e[e.STORE=24]="STORE",e[e.ENTER_SCOPE=25]="ENTER_SCOPE",e[e.LEAVE_SCOPE=26]="LEAVE_SCOPE",e[e.TRY=27]="TRY",e[e.CATCH=28]="CATCH",e[e.THROW=29]="THROW",e[e.NEW=30]="NEW",e[e.POP_AND_DISCARD=31]="POP_AND_DISCARD",e[e.DUPLICATE_VALUE=32]="DUPLICATE_VALUE",e[e.LOOP_EXIT=33]="LOOP_EXIT",e[e.LOOP_START=34]="LOOP_START",e[e.LOOP_END=35]="LOOP_END",e[e.CREATE_OBJECT=36]="CREATE_OBJECT",e[e.PRINT=37]="PRINT",e[e.DEBUGGER=38]="DEBUGGER",e[e.START=39]="START",e[e.EOF=40]="EOF"}(n||(t.OpCode=n={}))},7033:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const s=n(8017),o=n(8296),i=n(3641),r=n(9355),a=n(3579),p=n(9402),c=n(554),h=n(7593),u=n(6017),d=n(2802),l=n(3549),T=n(42),E=n(3651),k=n(335),m=n(6295),_=n(4736),S=n(1936),I=n(7856),C=n(2698),y=n(8262),x=n(4768),O=n(8237),f=n(1226),R=n(2351),v=n(2247),b=n(2880),g=n(5584),L=n(7623),w=n(3246),A=n(3125),N=n(1661),P=n(5522),M=n(6351),B=n(6341),U=n(4178),F=n(4240),D=n(2728);class V{constructor(e){this._tokens=e,this._currentTokenIndex=0}static parse(e){return new V(e)._doParse()}_doParse(){const e=[];for(;!this.endOfTokenStream();){var t=this.declaration();e.push(t)}return e}endOfTokenStream(){return this.peek().type==s.TokenType.EOF}match(...e){for(let t=0;t<e.length;t++)if(this.check(e[t]))return this.advance(),!0;return!1}check(e,t=0){return!this.endOfTokenStream()&&this.peek(t).type==e}peek(e=0){return this._tokens[this._currentTokenIndex+e]}advance(){return this.endOfTokenStream()||this._currentTokenIndex++,this.previous()}previous(e=0){return this._tokens[this._currentTokenIndex-1-1*e]}consume(e,t){if(this.check(e))return this.advance();if(e==s.TokenType.SEMICOLON&&this._tokens[this._currentTokenIndex-1].followed_by_line_break)return new o.Token(s.TokenType.SEMICOLON,"","",-1,-1,-1,-1);if(e==s.TokenType.SEMICOLON&&(this.check(s.TokenType.RIGHT_BRACE)||this.peek().type==s.TokenType.EOF))return new o.Token(s.TokenType.SEMICOLON,"","",-1,-1,-1,-1);throw new Error("ERROR IN PARSER: "+t+" but got "+s.TokenType[this.peek().type]+" [line: "+this.previous().line.toString()+"]")}declaration(){return this.match(s.TokenType.VAR)?this.varDeclaration():this.match(s.TokenType.FUNC)?this.functionDeclaration():this.match(s.TokenType.CLASS)?this.classDeclaration():this.statement()}varDeclaration(){const e=this._currentTokenIndex-1,t=this.consume(s.TokenType.IDENTIFIER,"Expected variable name");let n;this.match(s.TokenType.EQUAL)&&(n=this.expression());const o=-1==this.consume(s.TokenType.SEMICOLON,"Expected ;").start_pos?1:2,r=this._currentTokenIndex-o,a=new i.VarStatement(t,n);return a.firstTokenIndex=e,a.lastTokenIndex=r,a}functionDeclaration(){const e=this.consume(s.TokenType.IDENTIFIER,"Expected function name"),t=[];if(this.consume(s.TokenType.LEFT_BRACKET,"Expected ("),!this.check(s.TokenType.RIGHT_BRACKET))do{if(t.length>=127)throw new Error("Too many params");t.push(this.consume(s.TokenType.IDENTIFIER,"Expected parameter name"))}while(this.match(s.TokenType.COMMA));this.consume(s.TokenType.RIGHT_BRACKET,"Expected )"),this.consume(s.TokenType.LEFT_BRACE,"Expected {");const n=this.block();return new _.FunctionStatement(e,t,n)}classDeclaration(){const e=this.consume(s.TokenType.IDENTIFIER,"Expected function name");let t;const n=new Array;for(this.match(s.TokenType.COLON)&&(t=this.consume(s.TokenType.IDENTIFIER,"Expected superclass name")),this.consume(s.TokenType.LEFT_BRACE,"Expected {");!this.check(s.TokenType.RIGHT_BRACE)&&!this.endOfTokenStream();){if(!this.check(s.TokenType.IDENTIFIER)||!this.check(s.TokenType.LEFT_BRACKET,1))throw new Error(`Didn't expect to find ${this.peek()} in the class body`);{const e=this.functionDeclaration();n.push(e)}}return this.consume(s.TokenType.RIGHT_BRACE,"Expected }"),new y.ClassStatement(e,t,n)}statement(){return this.match(s.TokenType.IF)?this.ifStatement():this.match(s.TokenType.WHILE)?this.whileStatement():this.match(s.TokenType.LEFT_BRACE)?this.block():this.match(s.TokenType.PRINT)?this.printStatement():this.match(s.TokenType.BREAK)?this.breakStatement():this.match(s.TokenType.RETURN)?this.returnStatement():this.match(s.TokenType.TRY)?this.tryStatement():this.match(s.TokenType.THROW)?this.throwStatement():this.match(s.TokenType.FOR)?this.forStatement():this.match(s.TokenType.CONTINUE)?this.continueStatement():this.match(s.TokenType.DEBUGGER)?this.debuggerStatement():this.expressionStatement()}printStatement(){const e=this.expression();return this.consume(s.TokenType.SEMICOLON,"Expected ;"),new d.PrintStatement(e)}throwStatement(){const e=this.expression();return this.consume(s.TokenType.SEMICOLON,"Expected ;"),new x.ThrowStatement(e)}returnStatement(){if(this.peek().type==s.TokenType.SEMICOLON||this.peek().type==s.TokenType.RIGHT_BRACE||this.previous().followed_by_line_break)return this.consume(s.TokenType.SEMICOLON,"Expected ;"),new C.ReturnStatement(void 0);{const e=this.expression();return this.consume(s.TokenType.SEMICOLON,"Expected ;"),new C.ReturnStatement(e)}}breakStatement(){const e=this._currentTokenIndex-1;this.consume(s.TokenType.SEMICOLON,"Expected ;");var t=new I.BreakStatement;return t.tokenIndex=e,t}continueStatement(){const e=this._currentTokenIndex-1;this.consume(s.TokenType.SEMICOLON,"Expected ;");var t=new O.ContinueStatement;return t.tokenIndex=e,t}debuggerStatement(){const e=this._currentTokenIndex-1;this.consume(s.TokenType.SEMICOLON,"Expected ;");var t=new f.DebuggerStatement;return t.tokenIndex=e,t}block(){const e=this._currentTokenIndex-1,t=[];for(;!this.check(s.TokenType.RIGHT_BRACE)&&!this.endOfTokenStream();)t.push(this.declaration());this.consume(s.TokenType.RIGHT_BRACE,"Expected '}' after block.");const n=this._currentTokenIndex-1;var o=new S.BlockStatement(t);return o.blockStartTokenIndex=e,o.blockEndTokenIndex=n,o}ifStatement(){const e=this._currentTokenIndex-1;this.consume(s.TokenType.LEFT_BRACKET,"Expected (");const t=this.expression();this.consume(s.TokenType.RIGHT_BRACKET,"Expected )");const n=this._currentTokenIndex-1,o=this._currentTokenIndex,i=this.statement(),r=this._currentTokenIndex-1;var a;this.match(s.TokenType.ELSE)&&(a=this.statement());const p=new l.IfStatement(t,i,a);return p.exprFirstTokenIndex=e,p.exprLastTokenIndex=n,p.thenFirstTokenIndex=o,p.thenLastTokenIndex=r,p}whileStatement(){const e=this._currentTokenIndex-1;this.consume(s.TokenType.LEFT_BRACKET,"Expected (");const t=this.expression();this.consume(s.TokenType.RIGHT_BRACKET,"Expected )");const n=this._currentTokenIndex-1,o=this._currentTokenIndex,i=this.statement(),r=this._currentTokenIndex-1,a=new m.WhileStatement(t,i);return a.exprFirstTokenIndex=e,a.exprLastTokenIndex=n,a.stmtFirstTokenIndex=o,a.stmtLastTokenIndex=r,a}tryStatement(){this.consume(s.TokenType.LEFT_BRACE,"Expected {");const e=this.block();let t,n,o;return this.match(s.TokenType.CATCH)&&(this.match(s.TokenType.LEFT_BRACKET)&&(o=this.consume(s.TokenType.IDENTIFIER,"Expected a single variable name for exception variable"),this.consume(s.TokenType.RIGHT_BRACKET,"Expected )")),this.consume(s.TokenType.LEFT_BRACE,"Expected {"),t=this.block()),this.match(s.TokenType.FINALLY)&&(this.consume(s.TokenType.LEFT_BRACE,"Expected {"),n=this.block()),null==t&&null==n&&this.consume(s.TokenType.CATCH,"Expected catch or finally"),new R.TryStatement(e,o,t,n)}forStatement(){this.consume(s.TokenType.LEFT_BRACKET,"Expected (");let e,t,n,o,i,a,p=null;p=this.match(s.TokenType.SEMICOLON)?null:this.match(s.TokenType.VAR)?this.varDeclaration():this.expressionStatement(),this.check(s.TokenType.SEMICOLON)?e=new r.LiteralExpression(new B.SmolBool(!0)):(t=this._currentTokenIndex,e=this.expression(),n=this._currentTokenIndex-1),this.consume(s.TokenType.SEMICOLON,"Expected ;"),this.check(s.TokenType.RIGHT_BRACKET)||(i=this._currentTokenIndex,o=this.expression(),a=this._currentTokenIndex-1),this.consume(s.TokenType.RIGHT_BRACKET,"Expected )");let c=this.statement();if(null!=o){let e=new u.ExpressionStatement(o);e.firstTokenIndex=i,e.lastTokenIndex=a;const t=[c,e];c=new S.BlockStatement(t,!0)}let h=new m.WhileStatement(e,c);return h.exprFirstTokenIndex=t,h.exprLastTokenIndex=n,null!=p?new S.BlockStatement([p,h],!0):h}expressionStatement(){const e=this._currentTokenIndex,t=this.expression(),n=-1==this.consume(s.TokenType.SEMICOLON,"Expected ;").start_pos?1:2,o=this._currentTokenIndex-n,i=new u.ExpressionStatement(t);return i.firstTokenIndex=e,i.lastTokenIndex=o,i}expression(){const e=this.assignment();if(this.match(s.TokenType.QUESTION_MARK)){const t=this.expression();this.consume(s.TokenType.COLON,"Expected :");const n=this.expression();return new v.TernaryExpression(e,t,n)}return e}assignment(){const e=this.functionExpression();if(this.match(s.TokenType.EQUAL)){const t=this.assignment();if(e instanceof p.VariableExpression){const n=e.name;return new h.AssignExpression(n,t)}if(e instanceof L.GetExpression){const n=e;return new b.SetExpression(n.obj,n.name,t)}if(e instanceof w.IndexerGetExpression){const n=e;return new g.IndexerSetExpression(n.obj,n.indexerExpr,t)}throw new Error("Invalid assignment target")}if(this.match(s.TokenType.PLUS_EQUALS)){const t=this.previous(),n=this.assignment(),i=new c.BinaryExpression(e,new o.Token(s.TokenType.PLUS,"+=",void 0,t.line,t.col,t.start_pos,t.end_pos),n);if(e instanceof p.VariableExpression){const t=e.name;return new h.AssignExpression(t,i)}if(e instanceof L.GetExpression){const t=e;return new b.SetExpression(t.obj,t.name,i)}if(e instanceof w.IndexerGetExpression){const t=e;return new g.IndexerSetExpression(t.obj,t.indexerExpr,i)}throw new Error("Invalid assignment target")}if(this.match(s.TokenType.MINUS_EQUALS)){const t=this.previous(),n=this.assignment(),i=new c.BinaryExpression(e,new o.Token(s.TokenType.MINUS,"-=",void 0,t.line,t.col,t.start_pos,t.end_pos),n);if(e instanceof p.VariableExpression){const t=e.name;return new h.AssignExpression(t,i)}if(e instanceof L.GetExpression){const t=e;return new b.SetExpression(t.obj,t.name,i)}if(e instanceof w.IndexerGetExpression){const t=e;return new g.IndexerSetExpression(t.obj,t.indexerExpr,i)}throw new Error("Invalid assignment target")}if(this.match(s.TokenType.DIVIDE_EQUALS)){const t=this.previous(),n=this.assignment(),i=new c.BinaryExpression(e,new o.Token(s.TokenType.DIVIDE,"/=",void 0,t.line,t.col,t.start_pos,t.end_pos),n);if(e instanceof p.VariableExpression){const t=e.name;return new h.AssignExpression(t,i)}if(e instanceof L.GetExpression){const t=e;return new b.SetExpression(t.obj,t.name,i)}if(e instanceof w.IndexerGetExpression){const t=e;return new g.IndexerSetExpression(t.obj,t.indexerExpr,i)}throw new Error("Invalid assignment target")}if(this.match(s.TokenType.REMAINDER_EQUALS)){const t=this.previous(),n=this.assignment(),i=new c.BinaryExpression(e,new o.Token(s.TokenType.REMAINDER,"%=",void 0,t.line,t.col,t.start_pos,t.end_pos),n);if(e instanceof p.VariableExpression){const t=e.name;return new h.AssignExpression(t,i)}if(e instanceof L.GetExpression){const t=e;return new b.SetExpression(t.obj,t.name,i)}if(e instanceof w.IndexerGetExpression){const t=e;return new g.IndexerSetExpression(t.obj,t.indexerExpr,i)}throw new Error("Invalid assignment target")}if(this.match(s.TokenType.MULTIPLY_EQUALS)){const t=this.previous(),n=this.assignment(),i=new c.BinaryExpression(e,new o.Token(s.TokenType.MULTIPLY,"*=",void 0,t.line,t.col,t.start_pos,t.end_pos),n);if(e instanceof p.VariableExpression){const t=e.name;return new h.AssignExpression(t,i)}if(e instanceof L.GetExpression){const t=e;return new b.SetExpression(t.obj,t.name,i)}if(e instanceof w.IndexerGetExpression){const t=e;return new g.IndexerSetExpression(t.obj,t.indexerExpr,i)}throw new Error("Invalid assignment target")}if(this.match(s.TokenType.POW_EQUALS)){const t=this.previous(),n=this.assignment(),i=new c.BinaryExpression(e,new o.Token(s.TokenType.POW,"**=",void 0,t.line,t.col,t.start_pos,t.end_pos),n);if(e instanceof p.VariableExpression){const t=e.name;return new h.AssignExpression(t,i)}if(e instanceof L.GetExpression){const t=e;return new b.SetExpression(t.obj,t.name,i)}if(e instanceof w.IndexerGetExpression){const t=e;return new g.IndexerSetExpression(t.obj,t.indexerExpr,i)}throw new Error("Invalid assignment target")}return e}functionExpression(){if(this.match(s.TokenType.FUNC)){const e=[];if(this.consume(s.TokenType.LEFT_BRACKET,"Expected ("),!this.check(s.TokenType.RIGHT_BRACKET))do{e.push(this.consume(s.TokenType.IDENTIFIER,"Expected parameter name"))}while(this.match(s.TokenType.COMMA));this.consume(s.TokenType.RIGHT_BRACKET,"Expected )"),this.consume(s.TokenType.LEFT_BRACE,"Expected {");const t=this.block();return new A.FunctionExpression(e,t)}return this.logicalOr()}logicalOr(){let e=this.logicalAnd();for(;this.match(s.TokenType.LOGICAL_OR);){const t=this.previous(),n=this.logicalAnd();e=new T.LogicalExpression(e,t,n)}return e}logicalAnd(){let e=this.equality();for(;this.match(s.TokenType.LOGICAL_AND);){const t=this.previous(),n=this.equality();e=new T.LogicalExpression(e,t,n)}return e}equality(){let e=this.comparison();for(;this.match(s.TokenType.NOT_EQUAL,s.TokenType.EQUAL_EQUAL);){const t=this.previous(),n=this.comparison();e=new c.BinaryExpression(e,t,n)}return e}comparison(){let e=this.bitwise_op();for(;this.match(s.TokenType.GREATER,s.TokenType.GREATER_EQUAL,s.TokenType.LESS,s.TokenType.LESS_EQUAL);){const t=this.previous(),n=this.term();e=new c.BinaryExpression(e,t,n)}return e}bitwise_op(){let e=this.term();for(;this.match(s.TokenType.BITWISE_AND,s.TokenType.BITWISE_OR,s.TokenType.REMAINDER);){const t=this.previous(),n=this.term();e=new c.BinaryExpression(e,t,n)}return e}term(){let e=this.factor();for(;this.match(s.TokenType.MINUS,s.TokenType.PLUS);){const t=this.previous(),n=this.factor();e=new c.BinaryExpression(e,t,n)}return e}factor(){let e=this.pow();for(;this.match(s.TokenType.MULTIPLY,s.TokenType.DIVIDE);){const t=this.previous(),n=this.pow();e=new c.BinaryExpression(e,t,n)}return e}pow(){let e=this.unary();for(;this.match(s.TokenType.POW);){const t=this.previous(),n=this.unary();e=new c.BinaryExpression(e,t,n)}return e}unary(){if(this.match(s.TokenType.NOT,s.TokenType.MINUS)){const e=this.previous(),t=this.unary();return new k.UnaryExpression(e,t)}return this.call()}call(){let e=this.primary();for(;;)if(this.match(s.TokenType.LEFT_BRACKET))e=this.finishCall(e,e instanceof L.GetExpression);else if(this.match(s.TokenType.LEFT_SQUARE_BRACKET)){const t=this.expression();this.consume(s.TokenType.RIGHT_SQUARE_BRACKET,"Expected ]"),e=new w.IndexerGetExpression(e,t)}else{if(!this.match(s.TokenType.DOT))break;{const t=this.consume(s.TokenType.IDENTIFIER,"Expect property name after '.'.");e=new L.GetExpression(e,t)}}return e}finishCall(e,t=!1){const n=new Array;if(!this.check(s.TokenType.RIGHT_BRACKET))do{n.push(this.expression())}while(this.match(s.TokenType.COMMA));return this.consume(s.TokenType.RIGHT_BRACKET,"Expected )"),new E.CallExpression(e,n,t)}primary(){if(this.match(s.TokenType.FALSE))return new r.LiteralExpression(new B.SmolBool(!1));if(this.match(s.TokenType.TRUE))return new r.LiteralExpression(new B.SmolBool(!0));if(this.match(s.TokenType.NULL))return new r.LiteralExpression(new U.SmolNull);if(this.match(s.TokenType.UNDEFINED))return new r.LiteralExpression(new F.SmolUndefined);if(this.match(s.TokenType.NUMBER))return new r.LiteralExpression(new D.SmolNumber(Number(this.previous().literal)));if(this.match(s.TokenType.STRING))return new r.LiteralExpression(new M.SmolString(this.previous().literal));if(this.match(s.TokenType.PREFIX_INCREMENT)&&this.match(s.TokenType.IDENTIFIER))return new p.VariableExpression(this.previous(),s.TokenType.PREFIX_INCREMENT);if(this.match(s.TokenType.PREFIX_DECREMENT)&&this.match(s.TokenType.IDENTIFIER))return new p.VariableExpression(this.previous(),s.TokenType.PREFIX_DECREMENT);if(this.match(s.TokenType.IDENTIFIER))return this.match(s.TokenType.POSTFIX_INCREMENT)?new p.VariableExpression(this.previous(1),s.TokenType.POSTFIX_INCREMENT):this.match(s.TokenType.POSTFIX_DECREMENT)?new p.VariableExpression(this.previous(1),s.TokenType.POSTFIX_DECREMENT):new p.VariableExpression(this.previous(),void 0);if(this.match(s.TokenType.NEW)){const e=this.consume(s.TokenType.IDENTIFIER,"Expected identifier after new");this.consume(s.TokenType.LEFT_BRACKET,"Expect ')' after expression.");const t=new Array;if(!this.check(s.TokenType.RIGHT_BRACKET))do{t.push(this.expression())}while(this.match(s.TokenType.COMMA));return this.consume(s.TokenType.RIGHT_BRACKET,"Expected )"),new N.NewInstanceExpression(e,t)}if(this.match(s.TokenType.LEFT_SQUARE_BRACKET)){const e=this.previous(),t=new o.Token(s.TokenType.IDENTIFIER,"Array",void 0,e.line,e.col,e.start_pos,e.end_pos),n=new Array;if(!this.check(s.TokenType.RIGHT_SQUARE_BRACKET))do{n.push(this.expression())}while(this.match(s.TokenType.COMMA));return this.consume(s.TokenType.RIGHT_SQUARE_BRACKET,"Expected ]"),new N.NewInstanceExpression(t,n)}if(this.match(s.TokenType.LEFT_BRACE)){const e=this.previous(),t=new o.Token(s.TokenType.IDENTIFIER,"Object",void 0,e.line,e.col,e.start_pos,e.end_pos),n=new Array;if(!this.check(s.TokenType.RIGHT_BRACE))do{const e=this.consume(s.TokenType.IDENTIFIER,"Expected idetifier");this.consume(s.TokenType.COLON,"Exepcted :");const t=this.expression();n.push(new P.ObjectInitializerExpression(e,t))}while(this.match(s.TokenType.COMMA));return this.consume(s.TokenType.RIGHT_BRACE,"Expected }"),new N.NewInstanceExpression(t,n)}if(this.match(s.TokenType.LEFT_BRACKET)){const e=this.expression();return this.consume(s.TokenType.RIGHT_BRACKET,"Expect ')' after expression."),new a.GroupingExpression(e)}throw new Error(`Parser did not expect to see token "${s.TokenType[this.peek().type]}" on line ${this.peek().line}, sorry :(`)}}t.Parser=V},44:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.RunMode=void 0,function(e){e[e.Ready=0]="Ready",e[e.Run=1]="Run",e[e.Paused=2]="Paused",e[e.Step=3]="Step",e[e.Done=4]="Done"}(n||(t.RunMode=n={}))},3427:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scanner=void 0;const s=n(8017),o=n(8296);class i{constructor(e){this._currentPos=0,this._previous=0,this._startOfToken=0,this._currentLine=1,this._currentLineStartIndex=0,this._tokens=[],this._errors=[],this._charIsDigitRegex=new RegExp("[0-9]"),this._charIsAlphaRegex=new RegExp("[A-Za-z_]"),this._source=e,this._keywords={},this._keywords.break=s.TokenType.BREAK,this._keywords.class=s.TokenType.CLASS,this._keywords.case=s.TokenType.CASE,this._keywords.continue=s.TokenType.CONTINUE,this._keywords.debugger=s.TokenType.DEBUGGER,this._keywords.do=s.TokenType.DO,this._keywords.else=s.TokenType.ELSE,this._keywords.false=s.TokenType.FALSE,this._keywords.for=s.TokenType.FOR,this._keywords.function=s.TokenType.FUNC,this._keywords.if=s.TokenType.IF,this._keywords.null=s.TokenType.NULL,this._keywords.new=s.TokenType.NEW,this._keywords.print=s.TokenType.PRINT,this._keywords.return=s.TokenType.RETURN,this._keywords.super=s.TokenType.SUPER,this._keywords.switch=s.TokenType.SWITCH,this._keywords.true=s.TokenType.TRUE,this._keywords.var=s.TokenType.VAR,this._keywords.while=s.TokenType.WHILE,this._keywords[void 0]=s.TokenType.UNDEFINED,this._keywords.try=s.TokenType.TRY,this._keywords.catch=s.TokenType.CATCH,this._keywords.finally=s.TokenType.FINALLY,this._keywords.throw=s.TokenType.THROW}static tokenize(e){return new i(e).scanTokens()}scanTokens(){for(;!this.endOfFile();)this._startOfToken=this._currentPos,this.scanToken();return this._tokens.push(new o.Token(s.TokenType.EOF,"",void 0,this._currentLine,this._currentPos,this._currentPos,this._currentPos)),this._tokens}endOfFile(){return this._currentPos>=this._source.length}scanToken(){let e=this.nextChar();switch(e){case"(":this.addToken(s.TokenType.LEFT_BRACKET);break;case")":this.addToken(s.TokenType.RIGHT_BRACKET);break;case"{":this.addToken(s.TokenType.LEFT_BRACE);break;case"}":this.addToken(s.TokenType.RIGHT_BRACE);break;case"[":this.addToken(s.TokenType.LEFT_SQUARE_BRACKET);break;case"]":this.addToken(s.TokenType.RIGHT_SQUARE_BRACKET);break;case",":this.addToken(s.TokenType.COMMA);break;case".":this.addToken(s.TokenType.DOT);break;case"?":this.addToken(s.TokenType.QUESTION_MARK);break;case":":this.addToken(s.TokenType.COLON);break;case"-":this.matchNext("-")?this._tokens.length>0&&this._tokens[this._tokens.length-1].type==s.TokenType.IDENTIFIER&&0==this._tokens[this._tokens.length-1].followed_by_line_break?this.addToken(s.TokenType.POSTFIX_DECREMENT):this.addToken(s.TokenType.PREFIX_DECREMENT):this.matchNext("=")?this.addToken(s.TokenType.MINUS_EQUALS):this.addToken(s.TokenType.MINUS);break;case"+":this.matchNext("+")?this._tokens.length>0&&this._tokens[this._tokens.length-1].type==s.TokenType.IDENTIFIER&&0==this._tokens[this._tokens.length-1].followed_by_line_break?this.addToken(s.TokenType.POSTFIX_INCREMENT):this.addToken(s.TokenType.PREFIX_INCREMENT):this.matchNext("=")?this.addToken(s.TokenType.PLUS_EQUALS):this.addToken(s.TokenType.PLUS);break;case";":this.addToken(s.TokenType.SEMICOLON);break;case"*":this.matchNext("*")?this.matchNext("=")?this.addToken(s.TokenType.POW_EQUALS):this.addToken(s.TokenType.POW):this.matchNext("=")?this.addToken(s.TokenType.MULTIPLY_EQUALS):this.addToken(s.TokenType.MULTIPLY);break;case"!":this.matchNext("=")?this.addToken(s.TokenType.NOT_EQUAL):this.addToken(s.TokenType.NOT);break;case"=":this.matchNext("=")?this.addToken(s.TokenType.EQUAL_EQUAL):this.addToken(s.TokenType.EQUAL);break;case"<":this.matchNext("=")?this.addToken(s.TokenType.LESS_EQUAL):this.addToken(s.TokenType.LESS);break;case">":this.matchNext("=")?this.addToken(s.TokenType.GREATER_EQUAL):this.addToken(s.TokenType.GREATER);break;case"/":if(this.matchNext("/"))for(;"\n"!=this.peek()&&!this.endOfFile();)this.nextChar();else if(this.matchNext("*")){for(;"*"!=this.peek()||"/"!=this.peek(1);){if(this.endOfFile())throw new Error("Expected end of a comment block but reached the end of the file");e=this.nextChar(),"\n"==e&&(this._currentLine++,this._currentLineStartIndex=this._currentPos)}this.matchNext("*"),this.matchNext("/")}else this.matchNext("=")?this.addToken(s.TokenType.DIVIDE_EQUALS):this.addToken(s.TokenType.DIVIDE);break;case"%":this.matchNext("=")?this.addToken(s.TokenType.REMAINDER_EQUALS):this.addToken(s.TokenType.REMAINDER);break;case"&":this.matchNext("&")?this.addToken(s.TokenType.LOGICAL_AND):this.addToken(s.TokenType.BITWISE_AND);break;case"|":this.matchNext("|")?this.addToken(s.TokenType.LOGICAL_OR):this.addToken(s.TokenType.BITWISE_OR);break;case" ":this._previous=this._currentPos;case"\r":case"\t":break;case"\n":this._currentLine++,this._currentLineStartIndex=this._currentPos,this._tokens.length>0&&(this._tokens[this._tokens.length-1].followed_by_line_break=!0);break;case'"':this.processString('"');break;case"'":this.processString("'");break;case"`":this.processBacktickString();break;default:if(this.charIsDigit(e))this.processNumber();else{if(!this.charIsAlpha(e))throw console.log(`Unexpected character ${e}`),new Error(`Unexpected character ${e}`);this.processIdentifier()}}}nextChar(){return this._source.charAt(this._currentPos++)}peek(e=0){return this.endOfFile()?"\0":this._source.charAt(this._currentPos+e)}peekAhead(e){return this.endOfFile()?"\0":this._source.charAt(this._currentPos+e)}matchNext(e){return this.peek()==e&&(this.nextChar(),!0)}charIsDigit(e){return 1==e.length&&this._charIsDigitRegex.test(e)}charIsAlpha(e){return 1==e.length&&this._charIsAlphaRegex.test(e)}charIsAlphaNumeric(e){return this.charIsAlpha(e)||this.charIsDigit(e)}processNumber(){for(;this.charIsDigit(this.peek());)this.nextChar();if("."==this.peek()&&this.charIsDigit(this.peekAhead(1)))for(this.nextChar();this.charIsDigit(this.peek());)this.nextChar();const e=this._source.substring(this._startOfToken,this._currentPos);this.addTokenWithLiteral(s.TokenType.NUMBER,e)}processString(e){let t="";for(;this.peek()!=e&&!this.endOfFile();){if(this.matchNext("\n"))throw this._currentLine++,this._currentLineStartIndex=this._currentPos,new Error("Unexpected Line break in string");if("\\"==this.peek()){const e=this.peek(1);"'"==e||'"'==e||"\\"==e?(this.nextChar(),t+=this.nextChar()):"t"==e?(this.nextChar(),this.nextChar(),t+="\t"):"r"==e?(this.nextChar(),this.nextChar(),t+="\r"):"n"==e?(this.nextChar(),this.nextChar(),t+="\n"):t+=this.nextChar()}else t+=this.nextChar()}if(this.endOfFile())throw new Error("Unterminated string");this.nextChar(),this.addTokenWithLiteral(s.TokenType.STRING,t)}processBacktickString(){let e="",t=!1;for(;"`"!=this.peek()&&!this.endOfFile();)if("\n"==this.peek()&&(this._currentLine++,this._currentLineStartIndex=this._currentPos),"\\"==this.peek()){const t=this.peek(1);"'"==t||'"'==t||"\\"==t||"{"==t?(this.nextChar(),e+=this.nextChar()):"t"==t?(this.nextChar(),this.nextChar(),e+="\t"):"r"==t?(this.nextChar(),this.nextChar(),e+="\r"):"n"==t?(this.nextChar(),this.nextChar(),e+="\n"):e+=this.nextChar()}else if("$"==this.peek()&&"{"==this.peek(1)){e.length>0&&(this.addTokenWithLiteral(s.TokenType.STRING,e),e="",t=!0),this.nextChar(),this.nextChar();let n="",o=!1,r=null;for(;("}"!=this.peek()||o)&&!this.endOfFile();)(null==r&&("'"==this.peek()||'"'==this.peek())||null!=r&&this.peek()==r)&&(r=this.peek(),o=!o),n+=this.nextChar();if(this.nextChar(),n.length>0){t&&this.addToken(s.TokenType.PLUS);const e=new i(n).scanTokens();this.addToken(s.TokenType.LEFT_BRACKET);for(const t of e){if(t.type==s.TokenType.EOF)break;this._tokens.push(t)}this.addToken(s.TokenType.RIGHT_BRACKET),t=!0}}else e+=this.nextChar();if(this.endOfFile())throw new Error("Unterminated string");this.nextChar(),(e.length>0||!t)&&(t&&this.addToken(s.TokenType.PLUS),this.addTokenWithLiteral(s.TokenType.STRING,e))}processIdentifier(){for(;this.charIsAlphaNumeric(this.peek());)this.nextChar();const e=this._source.substring(this._startOfToken,this._currentPos);"constructor"!=e&&null!=this._keywords[e]?this.addTokenWithLiteral(this._keywords[e],e):this.addTokenWithLiteral(s.TokenType.IDENTIFIER,e)}addToken(e){this.addTokenWithLiteral(e)}addTokenWithLiteral(e,t=void 0){const n=this._source.substring(this._startOfToken,this._currentPos);this._tokens.push(new o.Token(e,n,t,this._currentLine,this._previous-this._currentLineStartIndex,this._previous,this._currentPos)),this._previous=this._currentPos}}t.Scanner=i},2590:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolProgram=void 0;const s=n(208);t.SmolProgram=class{constructor(){this.constants=[],this.code_sections=new Array,this.function_table=[],this.tokens=[]}decompile(e=!1){let t="";return t+=".constants\n",this.constants.forEach(((n,s)=>{var o;t+=e?`${s}: ${(null!==(o=n.getValue())&&void 0!==o?o:n).toString().replace("<","&lt;")}\n`:`${s}: ${n.getValue()}\n`})),t+="\n",this.code_sections.forEach(((n,o)=>{t+=`.code_section_${o}\n`,n.forEach(((n,i)=>{e&&(t+=`<div id="cs_${o}_${i}">`),n.isStatementStartpoint?t+="* ":t+="  ";const r=null!=n.operand1?` ${n.operand1}`:"",a=null!=n.operand2?` ${n.operand2}`:"";n.opcode==s.OpCode.CONST?t+=e?`${s.OpCode[n.opcode]} [${n.operand1}] ${this.constants[n.operand1].toString().replace("<","&lt;")}`:`${s.OpCode[n.opcode]} [${n.operand1}] ${this.constants[n.operand1]}`:t+=`${s.OpCode[n.opcode]}${r}${a}`,t+=e?"</div>":"\n"})),t+="\n"})),t+=".function_table:\n",this.function_table.forEach(((e,n)=>{t+=`${n}: name: ${e.global_function_name}, code_section: ${e.code_section}, arity: ${e.arity}, parameter names: ${e.param_variable_names}\n`})),t+="",t}}},6755:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolCallSiteSaveState=void 0;const s=n(6379);class o extends s.SmolStackType{constructor(e,t,n,s){super(),this.code_section=e,this.pc=t,this.previous_env=n,this.call_is_extern=s}}t.SmolCallSiteSaveState=o},5300:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolLoopMarker=void 0;const s=n(6379);class o extends s.SmolStackType{constructor(e){super(),this.current_env=e}}t.SmolLoopMarker=o},817:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolNativeFunctionResult=void 0;const s=n(6379);class o extends s.SmolStackType{}t.SmolNativeFunctionResult=o},6379:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolStackType=void 0,t.SmolStackType=class{}},3568:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolTryRegionSaveState=void 0;const s=n(6379);class o extends s.SmolStackType{constructor(e,t,n,s){super(),this.code_section=e,this.PC=t,this.this_env=n,this.jump_exception=s}}t.SmolTryRegionSaveState=o},5474:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ISmolNativeCallable=void 0;const s=n(8492);class o extends s.SmolVariableType{constructor(){super()}getValue(){}}t.ISmolNativeCallable=o},3558:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolArray=void 0;const s=n(5474),o=n(2728),i=n(4240);class r extends s.ISmolNativeCallable{constructor(){super(),this.array=[]}getValue(){return this}toString(){return`(SmolArray, length = ${this.array.length})`}getProp(e){var t;if("length"===e)return new o.SmolNumber(this.array.length);if(String(e).match(/[0-9]+/))return null!==(t=this.array[parseInt(e)])&&void 0!==t?t:new i.SmolUndefined;throw new Error(`Array does not contain property ${e}`)}setProp(e,t){if(!String(e).match(/[0-9]+/))throw new Error("Not a valid index");{const n=parseInt(e);this.array[n]=t}}nativeCall(e,t){switch(e){case"pop":{const e=this.array.pop();return null!=e?e:new i.SmolUndefined}case"push":return this.array.push(t[0]),t[0];default:throw new Error(`Array cannot handle native function ${e}`)}}static staticCall(e,t){if("constructor"===e){const e=new r;return t.forEach((t=>{e.array.push(t)})),e}throw new Error(`"Array class cannot handle static function ${e}`)}}t.SmolArray=r},6341:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolBool=void 0;const s=n(8492);class o extends s.SmolVariableType{constructor(e){super(),this._value=e}getValue(){return this._value}toString(){return`(SmolBool) ${this._value}`}}t.SmolBool=o},843:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolError=void 0;const s=n(8492);class o extends s.SmolVariableType{constructor(e){super(),this._message=e}getValue(){return`ERROR: ${this._message}`}}t.SmolError=o},8681:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolFunction=void 0;const s=n(8492);class o extends s.SmolVariableType{constructor(e,t,n,s){super(),this.param_variable_names=new Array,this.global_function_name=e,this.code_section=t,this.arity=n,this.param_variable_names=s}getValue(){return this}toString(){return`(SmolFunction) ${this.global_function_name}`}}t.SmolFunction=o},4178:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolNull=void 0;const s=n(8492);class o extends s.SmolVariableType{constructor(){super()}getValue(){return null}toString(){return"(SmolNull)"}}t.SmolNull=o},2728:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolNumber=void 0;const s=n(8492);class o extends s.SmolVariableType{constructor(e){super(),this._value=e}getValue(){return this._value}toString(){return`(SmolNumber) ${this._value}`}}t.SmolNumber=o},1930:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolObject=void 0;const s=n(4011),o=n(8492);class i extends o.SmolVariableType{constructor(e,t){super(),this.object_env=e,this.class_name=t}getValue(){return this}toString(){return""!=this.class_name?`(SmolInstance, class_name = ${this.class_name})`:"(SmolObject)"}getProp(e){throw new Error(`${this} cannot handle native property ${e}`)}setProp(e,t){throw new Error("Not a valid target")}nativeCall(e,t){throw new Error(`Object cannot handle native function ${e}`)}static staticCall(e,t){if("constructor"===e)return new i(new s.Environment,"Object");throw new Error(`Object class cannot handle static function ${e}`)}}t.SmolObject=i},9607:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolRegExp=void 0;const s=n(5474),o=n(6341);class i extends s.ISmolNativeCallable{constructor(e){super(),this._pattern=e,this._regex=new RegExp(e)}getValue(){return this}toString(){return`(SmolRegExp) ${this._pattern}`}setProp(e){throw new Error(`Property setting ${e} does not apply to SmolRegExp`)}getProp(e){throw new Error(`Can't get property ${e} on SmolRegExp`)}nativeCall(e,t){if("test"==e){const e=t[0];return new o.SmolBool(this._regex.test(e.getValue()))}throw new Error}static staticCall(e,t){if("constructor"===e){const e=t[0];return new i(e.getValue())}throw new Error(`Object class cannot handle static function ${e}`)}}t.SmolRegExp=i},6351:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolString=void 0;const s=n(5474),o=n(2728);class i extends s.ISmolNativeCallable{constructor(e){super(),this._value=e}getValue(){return this._value}toString(){return`(SmolString) ${this._value}`}setProp(e){throw new Error(`Property setting ${e} does not apply to String`)}getProp(e){if("length"==e)return new o.SmolNumber(this._value.toString().length);throw new Error(`Can't get property ${e} on SmolString`)}nativeCall(e,t){if("search"===e){const e=t[0];return new o.SmolNumber(this._value.search(e._regex))}if("substring"===e){const e=t[0];if(1==t.length)return new i(this._value.substring(e._value));{const n=t[1];return new i(this._value.substring(e._value,n._value))}}if("indexOf"===e){const e=t[0];return new o.SmolNumber(this._value.indexOf(e._value))}throw new Error(`String does not have function '${e}'`)}static staticCall(e,t){if("constructor"===e)return 1==t.length?new i(t[0]._value):new i("");throw new Error(`Object class cannot handle static function ${e}`)}}t.SmolString=i},4240:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolUndefined=void 0;const s=n(8492);class o extends s.SmolVariableType{constructor(){super()}getValue(){}toString(){return"(SmolUndefined)"}}t.SmolUndefined=o},2846:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolVariableCreator=void 0;const s=n(6341),o=n(4178),i=n(2728),r=n(6351),a=n(8492);t.SmolVariableCreator=class{static create(e){if(null==e)return new o.SmolNull;if(e instanceof a.SmolVariableType)return e;if("string"==typeof e)return new r.SmolString(e);if("number"==typeof e)return new i.SmolNumber(e);if("boolean"==typeof e)return new s.SmolBool(e);throw new Error(`Could not create a valid stack value from: ${e} (type = ${typeof e})`)}}},8492:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolVariableType=void 0;const s=n(6379);class o extends s.SmolStackType{equals(e){return this.getValue()==e.getValue()}}t.SmolVariableType=o},8296:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Token=void 0;const s=n(8017);t.Token=class{constructor(e,t,n,s,o,i,r){this.type=e,this.lexeme=t,this.literal=n,this.line=s,this.col=o,this.start_pos=i,this.end_pos=r,this.followed_by_line_break=!1}toString(){return`Token: ${s.TokenType[this.type]}, ${this.lexeme}, ${this.literal}`}}},8017:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TokenType=void 0,function(e){e[e.LEFT_BRACKET=0]="LEFT_BRACKET",e[e.RIGHT_BRACKET=1]="RIGHT_BRACKET",e[e.LEFT_BRACE=2]="LEFT_BRACE",e[e.RIGHT_BRACE=3]="RIGHT_BRACE",e[e.LEFT_SQUARE_BRACKET=4]="LEFT_SQUARE_BRACKET",e[e.RIGHT_SQUARE_BRACKET=5]="RIGHT_SQUARE_BRACKET",e[e.COMMA=6]="COMMA",e[e.DOT=7]="DOT",e[e.MINUS=8]="MINUS",e[e.PLUS=9]="PLUS",e[e.POW=10]="POW",e[e.SEMICOLON=11]="SEMICOLON",e[e.DIVIDE=12]="DIVIDE",e[e.REMAINDER=13]="REMAINDER",e[e.MULTIPLY=14]="MULTIPLY",e[e.LOGICAL_AND=15]="LOGICAL_AND",e[e.LOGICAL_OR=16]="LOGICAL_OR",e[e.BITWISE_AND=17]="BITWISE_AND",e[e.BITWISE_OR=18]="BITWISE_OR",e[e.BITWISE_XOR=19]="BITWISE_XOR",e[e.BITWISE_NOT=20]="BITWISE_NOT",e[e.QUESTION_MARK=21]="QUESTION_MARK",e[e.COLON=22]="COLON",e[e.NOT=23]="NOT",e[e.NOT_EQUAL=24]="NOT_EQUAL",e[e.EQUAL=25]="EQUAL",e[e.EQUAL_EQUAL=26]="EQUAL_EQUAL",e[e.GREATER=27]="GREATER",e[e.GREATER_EQUAL=28]="GREATER_EQUAL",e[e.LESS=29]="LESS",e[e.LESS_EQUAL=30]="LESS_EQUAL",e[e.PLUS_EQUALS=31]="PLUS_EQUALS",e[e.MINUS_EQUALS=32]="MINUS_EQUALS",e[e.MULTIPLY_EQUALS=33]="MULTIPLY_EQUALS",e[e.POW_EQUALS=34]="POW_EQUALS",e[e.DIVIDE_EQUALS=35]="DIVIDE_EQUALS",e[e.REMAINDER_EQUALS=36]="REMAINDER_EQUALS",e[e.POSTFIX_INCREMENT=37]="POSTFIX_INCREMENT",e[e.PREFIX_INCREMENT=38]="PREFIX_INCREMENT",e[e.POSTFIX_DECREMENT=39]="POSTFIX_DECREMENT",e[e.PREFIX_DECREMENT=40]="PREFIX_DECREMENT",e[e.IDENTIFIER=41]="IDENTIFIER",e[e.STRING=42]="STRING",e[e.NUMBER=43]="NUMBER",e[e.BREAK=44]="BREAK",e[e.CASE=45]="CASE",e[e.CLASS=46]="CLASS",e[e.CONST=47]="CONST",e[e.CONTINUE=48]="CONTINUE",e[e.DEBUGGER=49]="DEBUGGER",e[e.DO=50]="DO",e[e.ELSE=51]="ELSE",e[e.FALSE=52]="FALSE",e[e.FUNC=53]="FUNC",e[e.FOR=54]="FOR",e[e.IF=55]="IF",e[e.NEW=56]="NEW",e[e.NULL=57]="NULL",e[e.PRINT=58]="PRINT",e[e.RETURN=59]="RETURN",e[e.SUPER=60]="SUPER",e[e.SWITCH=61]="SWITCH",e[e.TRUE=62]="TRUE",e[e.VAR=63]="VAR",e[e.WHILE=64]="WHILE",e[e.UNDEFINED=65]="UNDEFINED",e[e.TRY=66]="TRY",e[e.CATCH=67]="CATCH",e[e.FINALLY=68]="FINALLY",e[e.THROW=69]="THROW",e[e.EOF=70]="EOF"}(n||(t.TokenType=n={}))},9969:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmolVM=void 0;const s=n(5672),o=n(4011),i=n(208),r=n(817),a=n(8681),p=n(1930),c=n(4240),h=n(6755),u=n(2728),d=n(6341),l=n(6351),T=n(3568),E=n(5300),k=n(5474),m=n(3558),_=n(44),S=n(9607),I=n(2846),C=n(843);class y extends Error{}class x{constructor(e){this.code_section=0,this.pc=0,this.runMode=_.RunMode.Paused,this.stack=[],this.jmplocs=[],this.maxStackSize=-1,this.maxCycles=-1,this.globalEnv=new o.Environment,this.environment=this.globalEnv,this.staticTypes={},this.classMethodRegEx=new RegExp("@([A-Za-z]+)[.]([A-Za-z]+)"),this.externalMethods={},this.debugFunc=void 0;const t=new s.Compiler;this.program=t.Compile(e),this.createStdLib(),this.buildJumpTable(),this.runMode=_.RunMode.Ready}static Compile(e){return new x(e)}static Init(e){const t=x.Compile(e);return t.run(),t}getGlobalVar(e){var t,n;return null!==(n=null===(t=this.globalEnv.tryGet(e))||void 0===t?void 0:t.getValue())&&void 0!==n?n:void 0}buildJumpTable(){for(let e=0;e<this.program.code_sections.length;e++)for(let t=0;t<this.program.code_sections[e].length;t++){const n=this.program.code_sections[e][t];n.opcode==i.OpCode.LABEL&&(this.jmplocs[n.operand1]=t)}}createStdLib(){this.staticTypes.Object=p.SmolObject,this.staticTypes.String=l.SmolString,this.staticTypes.Array=m.SmolArray,this.staticTypes.RegExp=S.SmolRegExp}decompile(){return this.program.decompile()}registerMethod(e,t){this.externalMethods[e]=t}callExternalMethod(e,t){let n=[];for(var s=0;s<t;s++){var o=this.stack.pop();n.push(o.getValue())}var i=this.externalMethods[e].apply(null,n);return void 0===i?new c.SmolUndefined:I.SmolVariableCreator.create(i)}call(e,...t){if(this.runMode!=_.RunMode.Done)throw new Error("Init() should be used before calling a function, to ensure the vm state is prepared");this.runMode=_.RunMode.Paused;var n=new h.SmolCallSiteSaveState(this.code_section,this.pc,this.environment,!0),s=new o.Environment(this.globalEnv);this.environment=s;for(var i=0;i<this.program.function_table.length&&this.program.function_table[i].global_function_name!=e;i++);if(-1==i)throw new Error(`Could not find a function named '${e}'`);var r=this.program.function_table[i];for(i=0;i<r.arity;i++)t.length>i?s.define(r.param_variable_names[i],I.SmolVariableCreator.create(t[i])):s.define(r.param_variable_names[i],new c.SmolUndefined);return this.stack.push(n),this.pc=0,this.code_section=r.code_section,this.run(),this.stack.pop().getValue()}set onDebugPrint(e){this.debugFunc=e}debug(e){null!=this.debugFunc&&this.debugFunc(e)}run(){this.runMode!=_.RunMode.Ready&&this.runMode!=_.RunMode.Paused||this._run(_.RunMode.Run)}step(){this.runMode!=_.RunMode.Ready&&this.runMode!=_.RunMode.Paused||this._run(_.RunMode.Step)}_run(e){this.runMode=e;let t=!1,n=0;for(;this.runMode==_.RunMode.Run||this.runMode==_.RunMode.Step;){if(this.runMode==_.RunMode.Step&&0==this.code_section&&this.program.code_sections[0].length<this.pc-1)return void(this.runMode=_.RunMode.Done);if(this.runMode==_.RunMode.Step&&this.program.code_sections[this.code_section][this.pc].isStatementStartpoint&&t)return void(this.runMode=_.RunMode.Paused);const e=this.program.code_sections[this.code_section][this.pc++];this.debug(i.OpCode[e.opcode]);try{switch(e.opcode){case i.OpCode.NOP:case i.OpCode.START:break;case i.OpCode.CONST:this.stack.push(this.program.constants[e.operand1]),this.debug(`              [Loaded Const ${this.program.constants[e.operand1].toString()}]`);break;case i.OpCode.CALL:{const t=this.stack.pop();if(t instanceof r.SmolNativeFunctionResult)break;const n=t;let s=new o.Environment(this.globalEnv);e.operand2&&(s=this.stack.pop().object_env);const i=new Array;for(let t=0;t<e.operand1;t++)i.push(this.stack.pop());for(let e=0;e<n.arity;e++)i.length>e?s.define(n.param_variable_names[e],i[e]):s.define(n.param_variable_names[e],new c.SmolUndefined);const a=new h.SmolCallSiteSaveState(this.code_section,this.pc,this.environment,!1);this.environment=s,this.stack.push(a),this.pc=0,this.code_section=n.code_section;break}case i.OpCode.ADD:{const e=this.stack.pop(),t=this.stack.pop();t instanceof u.SmolNumber&&e instanceof u.SmolNumber?this.stack.push(new u.SmolNumber(t.getValue()+e.getValue())):this.stack.push(new l.SmolString(t.getValue().toString()+e.getValue().toString()));break}case i.OpCode.SUB:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new u.SmolNumber(t.getValue()-e.getValue()));break}case i.OpCode.MUL:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new u.SmolNumber(t.getValue()*e.getValue()));break}case i.OpCode.DIV:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new u.SmolNumber(t.getValue()/e.getValue()));break}case i.OpCode.REM:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new u.SmolNumber(t.getValue()%e.getValue()));break}case i.OpCode.POW:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new u.SmolNumber(t.getValue()**e.getValue()));break}case i.OpCode.EQL:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new d.SmolBool(t.equals(e)));break}case i.OpCode.NEQ:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new d.SmolBool(!t.equals(e)));break}case i.OpCode.GT:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new d.SmolBool(t.getValue()>e.getValue()));break}case i.OpCode.LT:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new d.SmolBool(t.getValue()<e.getValue()));break}case i.OpCode.GTE:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new d.SmolBool(t.getValue()>=e.getValue()));break}case i.OpCode.LTE:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new d.SmolBool(t.getValue()<=e.getValue()));break}case i.OpCode.BITWISE_OR:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new u.SmolNumber(t.getValue()|e.getValue()));break}case i.OpCode.BITWISE_AND:{const e=this.stack.pop(),t=this.stack.pop();this.stack.push(new u.SmolNumber(t.getValue()&e.getValue()));break}case i.OpCode.EOF:return this.runMode=_.RunMode.Done,void this.pc--;case i.OpCode.RETURN:{const e=this.stack.pop(),t=this.stack.pop();if(!(t instanceof h.SmolCallSiteSaveState))throw new Error("Tried to return but found something unexecpted on the stack");const n=t;if(this.environment=n.previous_env,this.pc=n.pc,this.code_section=n.code_section,this.stack.push(null==e?new c.SmolUndefined:e),n.call_is_extern)return void(this.runMode=_.RunMode.Paused);break}case i.OpCode.DECLARE:this.environment.define(e.operand1,new c.SmolUndefined);break;case i.OpCode.STORE:{let t=e.operand1;"@IndexerSet"==t&&(t=this.stack.pop().getValue());const n=this.stack.pop();let s=this.environment,o=!1;if(null!=e.operand2&&e.operand2){const e=this.stack.pop();if(o=!0,!(e instanceof p.SmolObject)){if(e instanceof k.ISmolNativeCallable){e.setProp(t,n);break}throw new Error(`${e} is not a valid target for this call`)}s=e.object_env}s.assign(t,n,o),this.debug(`              [Saved ${n.toString()}]`);break}case i.OpCode.FETCH:{let t=e.operand1,n=this.environment;if("@IndexerGet"!=t&&"@IndexerSet"!=t||(t=this.stack.pop().getValue().toString()),null!=e.operand2&&e.operand2){const e=this.stack.pop(),s=this.program.code_sections[this.code_section][this.pc];if(e instanceof p.SmolObject)n=e.object_env,s.opcode==i.OpCode.CALL&&s.operand2&&this.stack.push(e);else{if(e instanceof k.ISmolNativeCallable){if(s.opcode==i.OpCode.CALL&&s.operand2){const n=new Array;for(let e=0;e<s.operand1;e++)n.push(this.stack.pop());this.stack.push(e.nativeCall(t,n)),this.stack.push(new r.SmolNativeFunctionResult)}else this.stack.push(e.getProp(t));break}if(!(e instanceof r.SmolNativeFunctionResult))throw new Error(`${e} is not a valid target for this call`);if(this.classMethodRegEx.test(t)){const e=this.classMethodRegEx.exec(t);if(null==e)throw new Error("class method name regex failed");const n=e[2],i=[];if("@Object.constructor"!=t){for(let e=0;e<s.operand1;e++)i.push(this.stack.pop());s.operand1}this.stack.pop();const a=this.staticTypes[e[1]].staticCall(n,i);"@Object.constructor"==t&&(a.object_env=new o.Environment(this.globalEnv)),this.stack.push(a),this.stack.push(new r.SmolNativeFunctionResult),this.stack.push(new r.SmolNativeFunctionResult);break}}}let s=n.tryGet(t);if(a.SmolFunction,null!=s)this.stack.push(s),this.debug(`              [Loaded ${s.getValue()}]`);else{const e=this.program.function_table.find((e=>e.global_function_name==t));if(null!=e)this.stack.push(e);else if(null!=this.externalMethods[t]){const e=this.program.code_sections[this.code_section][this.pc];this.stack.push(this.callExternalMethod(t,e.operand1)),this.stack.push(new r.SmolNativeFunctionResult)}else this.stack.push(new c.SmolUndefined)}break}case i.OpCode.JMPFALSE:0==this.stack.pop().getValue()&&(this.pc=this.jmplocs[e.operand1]);break;case i.OpCode.JMPTRUE:1==this.stack.pop().getValue()&&(this.pc=this.jmplocs[e.operand1]);break;case i.OpCode.JMP:this.pc=this.jmplocs[e.operand1];break;case i.OpCode.LABEL:break;case i.OpCode.ENTER_SCOPE:this.environment=new o.Environment(this.environment);break;case i.OpCode.LEAVE_SCOPE:this.environment=this.environment.enclosing;break;case i.OpCode.DEBUGGER:return void(this.runMode=_.RunMode.Paused);case i.OpCode.POP_AND_DISCARD:(this.stack.length>0||null==e.operand1||e.operand1)&&this.stack.pop();break;case i.OpCode.TRY:let t;null!=e.operand2&&e.operand2&&(t=this.stack.pop()),this.stack.push(new T.SmolTryRegionSaveState(this.code_section,this.pc,this.environment,this.jmplocs[e.operand1])),null!=t&&this.stack.push(t);break;case i.OpCode.THROW:throw e.operand1,new y("");case i.OpCode.LOOP_START:this.stack.push(new E.SmolLoopMarker(this.environment));break;case i.OpCode.LOOP_END:this.stack.pop();break;case i.OpCode.LOOP_EXIT:for(;this.stack.length>0;){const t=this.stack.pop();if(t instanceof E.SmolLoopMarker){this.environment=t.current_env,this.stack.push(t),null!=e.operand1&&(this.pc=this.jmplocs[e.operand1]);break}}break;case i.OpCode.CREATE_OBJECT:{const t=e.operand1;if(null!=this.staticTypes[t]){this.stack.push(new r.SmolNativeFunctionResult);break}const n=new o.Environment(this.globalEnv);this.program.function_table.filter((e=>e.global_function_name.startsWith(`@${t}.`))).forEach((e=>{const s=e.global_function_name.substring(t.length+2);n.define(s,new a.SmolFunction(e.global_function_name,e.code_section,e.arity,e.param_variable_names))})),this.stack.push(new p.SmolObject(n,t)),n.define("this",this.stack.peek());break}case i.OpCode.DUPLICATE_VALUE:{const t=null!=e.operand1?e.operand1:0,n=this.stack[this.stack.length-1-t];this.stack.push(n);break}case i.OpCode.PRINT:{const e=this.stack.pop();console.log(e.getValue());break}default:throw new Error(`You forgot to handle an opcode: ${e.opcode}`)}}catch(e){let t=!1,n=new C.SmolError(e.message);for(e instanceof y&&(n=this.stack.pop());this.stack.length>0;){const e=this.stack.pop();if(e instanceof T.SmolTryRegionSaveState){const s=e;this.code_section=s.code_section,this.pc=s.jump_exception,this.environment=s.this_env,this.stack.push(n),t=!0;break}}if(!t)throw e}if(this.maxStackSize>-1&&this.stack.length>this.maxStackSize)throw new Error("Stack overflow");if(t=!0,n+=1,this.maxCycles>-1&&n>this.maxCycles)throw new Error("Too many cycles")}}}t.SmolVM=x},2379:(e,t,n)=>{var s=n(9969),o=n(7672);void 0===o.SmolScript&&(o.SmolScript=s),e.exports=s},7672:(e,t,n)=>{"use strict";e.exports=function(){if("object"==typeof globalThis)return globalThis;var e;try{e=this||new Function("return this")()}catch(e){if("object"==typeof window)return window;if("object"==typeof self)return self;if(void 0!==n.g)return n.g}return e}()}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n(2379)})();