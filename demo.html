---
# Feel free to add content and custom Front Matter to this file.
# To modify the layout, see https://jekyllrb.com/docs/themes/#overriding-theme-defaults

layout: default
permalink: /interactive-demo
selected_nav_item: Interactive Demo
---

<div class="md:flex mt-4 flex-col lg:flex-row">

  <div class="mx-5 basis-full lg:basis-full md:pr-10">

    <h5 class="mt-8 mb-4 text-lg font-bold bg-slate-200 inline-block px-2 py-1">interactive demo</h5>

    <script src="smolscript-v0.3.js"></script>

    <script>
      var require = {
        paths: {
          vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs'
        }
      };
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"
      integrity="sha512-6bIYsGqvLpAiEBXPdRQeFf5cueeBECtAKJjIHer3BhBZNTV3WLcLA8Tm3pDfxUwTMIS+kAZwTUvJ1IrMdX8C5w=="
      crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.nls.min.js"
      integrity="sha512-CCv+DKWw+yZhxf4Z+ExT6HC5G+3S45TeMTYcJyYbdrv4BpK2vyALJ4FoVR/KGWDIPu7w4tNCOC9MJQIkYPR5FA=="
      crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" type="text/css" data-name="vs/editor/editor.main"
      href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.js"
      integrity="sha512-BtSZPhzoyN8kq1axY6cgOFPSgLJgFwvAZ3WxeDGxEFXeFcFuK2s7Hr+zF75npVHASUY1dxudAfIVzwmgdR89Bw=="
      crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <p class="py-3 mb-3">When you run code in the editor below, it is not running directly in your web browser's Javascript
      as you might expect, it is running in a standalone VM (and that VM is running in JS). Because of that, this script
      has no access to anything like document, window or alert().</p>

    <div class="flex flex-row" style="min-width:900px;">
      <div class="w-1/3 px-3 pt-2 pb-1 text-sm">
      </div>
      <div class="w-1/3 px-3 pt-2 pb-1 text-sm bg-gray-50">
        Compiled Bytecode
      </div>
      <div class="w-1/3 px-3 pt-2 pb-1 text-sm bg-gray-100">
        Global Variables
      </div>
    </div>

    <div class="flex flex-row" style="min-width:900px;">
      <div class="w-1/3 bg-slate-50 px-3 py-2">
        <div style="height:200px; border:solid 1px #ccc; padding:3px;" id="smolEditor"></div>
        <div class="right pt-2">
          <button onclick="run();"
            class="float-right bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-4 mr-1 rounded font-sans">
            Run
          </button>
          <p id="err" class="text-sm py-1"></p>
        </div>
      </div>
      <div class="w-1/3 bg-slate-100 px-3 py-2">
        <div id="decompiled" class="text-slate-600">
          <p class="text-sm my-2">When you compile your program the bytecode-style instructions will appear here.</p>
          <p class="text-sm my-2">Instructions that have * before them are 'checkpoints' for the step through debugger. They aren't fully implemented yet so might appear weird or inconsistent if you check too closely</p>
          <p class="text-sm my-2">You'll also notice that we do some wasteful operations. We don't optimise
            the output at all right now, but we might do some simple optimisations one day.
          </p>

        </div>
      </div>
      <div class="w-1/3 bg-slate-200 px-3 py-2 text-slate-700">
        <div id="results">
          <p class="text-sm my-2">When you run your program, the final value of any global variables generated by your program will be shown here.</p>
          <p class="text-sm my-2">Note that SmolScript is not 100% the same as Javascript with globals. Smol only supports var (not let), but var actually behaves like let unless its in the top-most scope.</p>
        </div>
      </div>
    </div>
    <script>

      function run() {
        try {
          var start = window.performance.now();

          document.getElementById("decompiled").innerHTML = '';
          document.getElementById("results").innerHTML = '';
          document.getElementById("err").innerText = '';

          var smol = SmolScript.SmolVM;

          var vm = smol.Compile(editor.getValue());

          vm.maxCycles = 100000000;

          document.getElementById("decompiled").innerHTML = `<pre>${vm.decompile().replaceAll('<', '&lt;')}</pre>`;

          vm.run();

          var x = `<table style="width:100%;">`;

          Object.keys(vm.globalEnv._variables).forEach((key) => {
            x += `<tr><td style="font-weight:bold;">${key}</td><td>${vm.globalEnv._variables[key].toString().replaceAll('<', '&lt;')}</td></tr>`;
          });

          x += '</table>';

          var end = window.performance.now();
          var time = end - start;

          document.getElementById("results").innerHTML = x;
          document.getElementById("err").innerText = `Done in ${Math.round(time, 20)} ms`;
        }
        catch (e) {
          document.getElementById("err").innerText = e;
        }
      }

      editor = monaco.editor.create(document.getElementById('smolEditor'), {
        value: `var y = 0;

for (var x = -2; x < 10; x++) {
  y += x;
}`,
        automaticLayout: true,
        scrollBeyondLastLine: false,
        language: 'js',
        theme: 'js',
        minimap: {
          enabled: false
        },
        //glyphMargin: false,
        folding: false,
        // Undocumented see https://github.com/Microsoft/vscode/issues/30795#issuecomment-410998882
        // lineDecorationsWidth: 0,
      });

    </script>

  </div>


</div>